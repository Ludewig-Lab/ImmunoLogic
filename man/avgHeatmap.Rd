% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/avgHeatmap.R
\name{avgHeatmap}
\alias{avgHeatmap}
\title{Average Expression Heatmap for Seurat Objects with Significance Testing}
\usage{
avgHeatmap(
  seurat,
  selGenes = NULL,
  group_by = NULL,
  condition_by = NULL,
  scale_method = "row",
  cluster_rows = FALSE,
  cluster_cols = FALSE,
  cluster_order = NULL,
  gene_order = NULL,
  show_rownames = TRUE,
  show_colnames = TRUE,
  cellwidth = 15,
  cellheight = 10,
  color_palette = NULL,
  annotation_colors = NULL,
  condition_colors = NULL,
  gaps_row = NULL,
  gaps_col = NULL,
  n_variable_genes = 20,
  show_significance = FALSE,
  significance_direction = "higher",
  significance_test = "wilcox",
  pval_cutoffs = c(`***` = 0.001, `**` = 0.01, `*` = 0.05),
  star_size = 8,
  p_adjust_method = "BH",
  colVecIdent = NULL,
  colVecCond = NULL,
  ordVec = NULL,
  gapVecR = NULL,
  gapVecC = NULL,
  cc = NULL,
  cr = NULL,
  condCol = NULL,
  ...
)
}
\arguments{
\item{seurat}{A Seurat object.}

\item{selGenes}{Character vector of genes to plot, or a data.frame with a column named \code{gene} or \code{geneID}. Defaults to \code{NULL}.}

\item{group_by}{Metadata column in the Seurat object to group cells by. Defaults to \code{NULL} (uses active identity).}

\item{condition_by}{Optional metadata column for a second grouping variable (e.g., treatment condition). Default is \code{NULL}.}

\item{scale_method}{Scaling method for the heatmap: \code{"row"}, \code{"column"}, or \code{"none"}. Default is \code{"row"}.}

\item{cluster_rows}{Logical, whether to cluster rows. Default is \code{FALSE}.}

\item{cluster_cols}{Logical, whether to cluster columns. Default is \code{FALSE}.}

\item{cluster_order}{Optional character vector to manually set the order of columns (clusters). Overrides \code{cluster_cols = FALSE}.}

\item{gene_order}{Optional character vector to manually set the order of rows (genes). Overrides \code{cluster_rows = FALSE}.}

\item{show_rownames}{Logical, whether to display row names (genes). Default is \code{TRUE}.}

\item{show_colnames}{Logical, whether to display column names (groups). Default is \code{TRUE}.}

\item{cellwidth}{Numeric, width of each cell in the heatmap. Default is \code{15}.}

\item{cellheight}{Numeric, height of each cell in the heatmap. Default is \code{10}.}

\item{color_palette}{Color vector for the heatmap. Default is a blue-white-red gradient.}

\item{annotation_colors}{Named list of colors for annotations. Can contain elements named 'Group' and 'Condition'.
Alternatively, provide a named vector which will be used for the Group annotation.}

\item{condition_colors}{Named vector of colors for condition annotation. Only used if \code{condition_by} is specified.}

\item{gaps_row}{Optional vector specifying rows after which to insert gaps. Default is \code{NULL}.}

\item{gaps_col}{Optional vector specifying columns after which to insert gaps. Default is \code{NULL}.}

\item{n_variable_genes}{Number of top variable genes to use if \code{selGenes} is \code{NULL}. Default is \code{20}.}

\item{show_significance}{Logical, whether to perform statistical testing and show significance stars. Default is \code{FALSE}.}

\item{significance_direction}{Direction for showing significance: "higher" (default), "lower", or "both".}

\item{significance_test}{Statistical test to use: "wilcox" (default) or "t.test".}

\item{pval_cutoffs}{Named numeric vector of p-value cutoffs. Default is \code{c("***" = 0.001, "**" = 0.01, "*" = 0.05)}.}

\item{star_size}{Numeric, font size for significance stars. Default is \code{8}.}

\item{p_adjust_method}{Method for p-value adjustment. Default is \code{"BH"} (Benjamini-Hochberg/FDR).
Use \code{"none"} for unadjusted p-values. See \code{?p.adjust} for other options.}

\item{...}{Additional arguments passed to \code{\link[pheatmap:pheatmap]{pheatmap::pheatmap()}}.}
}
\value{
A \code{pheatmap} object.
}
\description{
Generates a heatmap of averaged expression values for selected genes across cell groups or identities in a Seurat object.
If no genes are provided, the top variable features will be used. Optionally performs statistical testing and displays
significance stars on the heatmap.
}
\details{
\itemize{
\item Handles gene names as symbols or ENSEMBL IDs.
\item Automatically removes genes with zero variance across groups.
\item If \code{cluster_rows = FALSE} and \code{gene_order = NULL} (default),
orders genes by cluster of maximum expression to create a "staircase" pattern.
\item If \code{gene_order} is provided, genes are kept in the user-provided order.
\item If \code{cluster_order} is provided, clusters are kept in the user-provided order.
(When \code{condition_by} is used, this groups columns based on the cluster prefix).
\item Automatically selects color palettes based on group names and number of groups.
\item When \code{condition_by} is specified, creates combined groups (e.g., "Cluster0_ConditionA").
\item When \code{show_significance = TRUE}:
\itemize{
\item If \code{condition_by} is \code{NULL}: performs test comparing each cluster vs. all other clusters.
\item If \code{condition_by} is set: performs test comparing each group (e.g., "Cluster0_CondA")
vs. all \emph{other groups within that same base cluster} (e.g., "Cluster0_CondB", "Cluster0_CondC").
\item P-values are adjusted for multiple testing using the Benjamini-Hochberg method (FDR) by default.
}
}
}
\examples{
\dontrun{
library(Seurat)
seurat <- YourSeuratObject

# Simple heatmap with significance stars (higher than average)
avgHeatmap(seurat,
           selGenes = c("GeneA", "GeneB", "GeneC"),
           group_by = "celltype",
           show_significance = TRUE)

# Show significance for both higher and lower expression
avgHeatmap(seurat,
           selGenes = c("GeneA", "GeneB"),
           group_by = "celltype",
           show_significance = TRUE,
           significance_direction = "both")

# Custom p-value cutoffs
avgHeatmap(seurat,
           selGenes = c("GeneA", "GeneB"),
           group_by = "celltype",
           show_significance = TRUE,
           pval_cutoffs = c("***" = 0.0001, "**" = 0.001, "*" = 0.01))
}

}
\author{
Mechthild LÃ¼tge, Roman Stadler
}
